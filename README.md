
Process Monitor
===============

Process Monitor is a lightweight process to manage other processes on the system: starting, stopping, backups, configuration, updates, restarts, etc. Its goal is to cleanly catch any fatal exceptions and provide local error correction, as well as data/log backups. It can also handle process restarts and upgrades.


Process Monitor
 | 
 - Job
 |  |
 |  - Worker strategy
 |  |  |
 |  |  - Cmd to execute
 |  |  - Arguments to pass
 |  |
 |  - Clean Stop strategy
 |  |  |
 |  |  - Cmd to execute
 |  |  - Arguments to pass
 |  |
 |  - Remote Log strategy
 |  |  |
 |  |  - Cmd to execute
 |  |  - Arguments to pass
 |  |  - Interval at which the Process Monitor will execute
 |  |
 |  - Remote Data strategy
 |  |  |
 |  |  - Cmd to execute
 |  |  - Arguments to pass
 |  |  - Interval at which the Process Monitor will execute
 |  |
 |  - Upgrade strategy
 |     |
 |     - Cmd to execute
 |     - Arguments to execute
 |
 - Job
 |
 ...


Each strategy is a separate process that must exist on the system, else it will be ignored.

The basic Worker strategy is the main process to start and monitor. For all it knows, it's a stand-alone process and knows nothing about the other processes in the environment.

If the Clean Stop stragegy is defined, the Process Monitor will attempt to use to cleanly shut down the Worker if a "clean shutdown" request is received. A "clean shutdown" request is a request to kill the Worker, but waits until all current computations are completed before starting the shutdown. The Worker must provide an implementation for this procedure and an interface that the Clean Stop strategy can call.
If the Clean Stop strategy is undefined, the Process Monitor will perform a simple "kill process" to shut down the Worker.

If the Remote Log strategy is defined, it will periodically be called by the Process Monitor in order to perform remote backups of the local logs generated by the Worker.
If the Worker throws an unexpected exception, the Remote Log strategy will be called to backup existing logs before the Process Monitor restarts the Worker. This will also occur upon any shutdown/stop request for the Worker.

If the Remote Data strategy is defined, it will periodically be called by the Process Monitor in order to perform remote backups of the local data generated by the Worker.
If the Worker throws an unexpected exception, the Remote Data strategy will be called to backup existing data before the Process Monitor restarts the Worker. This will also occur upon any shutdown/stop request for the Worker.

If the Upgrade strategy is defined, it can be executed by the Process Monitor. It will:
 * Perform a Clean Stop of the running Worker.
    - This also performs a log/data backup, as defined above.
 * Copies the existing Job and all of its files to a temporary directory for rollback upon upgrade failure.
 * The current files will be deleted (except for data files).
 * Runs the defined upgrade command; this should be a process/script that will perform any necessary source downloads, compilation, etc.
    - If this fails, the upgrade files will be deleted and the rollback directory will be restored.
    - The upgrade process will be expected to delete the current data files, if they are no longer applicable.
 * The Worker will be started again, whether this is the new or the old Worker (executed if the upgrade fails).
